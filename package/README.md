# Kubernetes Log Analysis (k-log)

A command-line tool to analyze Kubernetes log bundles (like those generated by `k8s-debug.sh`) using Large Language Models (LLMs) via LiteLLM, with a primary focus on Google Gemini.

## Features

-   Takes a natural language query about your Kubernetes cluster state.
-   Identifies relevant log files from a standard log bundle structure (based on the provided `k8s-debug.sh` script).
-   Sends the query and extracted log data to an LLM (e.g., Gemini) for analysis.
-   Displays the LLM's response, aiming for answers in the language of the query (e.g., Chinese).

## Prerequisites

-   Python 3.8+
-   A Kubernetes log bundle directory (e.g., generated by `k8s-debug.sh`).
-   Google Gemini API Key (or an API key for another LiteLLM supported model).

## Installation

1.  Clone this repository or download the source code.
2.  Navigate to the `kubernetes-log-analysis` directory.
3.  Install the package and its dependencies:
    ```bash
    pip install .
    ```
    For development, you might prefer:
    ```bash
    pip install -e .
    ```

## Configuration

1.  **API Key**: The tool requires a `GOOGLE_API_KEY` for Gemini. Create a file named `.env` in the directory where you will run `k-log` (or in your project's root directory during development) with the following content:

    ```env
    GOOGLE_API_KEY="YOUR_GEMINI_API_KEY_HERE"
    ```
    Alternatively, ensure this environment variable is set globally.

2.  **LLM Model (Optional)**: You can specify a different LiteLLM-compatible model string by setting the `LLM_MODEL` environment variable in your `.env` file or globally. It defaults to `gemini/gemini-1.5-flash-latest`.
    ```env
    LLM_MODEL="gemini/gemini-pro" 
    ```

## Usage

1.  Ensure your `GOOGLE_API_KEY` is set (e.g., via the `.env` file).
2.  Navigate to your Kubernetes log bundle directory (e.g., `cd /path/to/k8s-debug-default-20250509034522`).
3.  Run the `k-log` command with your query:

    ```bash
    k-log "請問目前 nodes 狀態"
    ```
    Or, specify the log directory explicitly:
    ```bash
    k-log --log-dir /path/to/your/k8s-debug-default-20250509034522 "logs for pod kuberay-operator-6ddb59999c-mggc9"
    ```

### Example Queries:

-   `k-log "請問目前 nodes 狀態"`
-   `k-log "status of nodes"`
-   `k-log "logs for pod jupyterlab-54698b59b8-bmvgq in namespace default"`
-   `k-log "describe service kubernetes"`
-   `k-log "any critical events?"`

## How it Works

1.  **Query Interpretation**: The tool uses regular expressions and keyword matching to understand the type of information requested (e.g., "node status", "logs for a specific pod") and to extract resource names or namespaces.
2.  **File Identification**: Based on the interpreted query, it searches for corresponding files within the specified log directory (e.g., `nodes-wide.txt`, `logs/default/pod-name.log`).
3.  **Data Extraction**: It reads the content of these relevant files. Very large files are truncated to manage LLM context window limits.
4.  **LLM Interaction**: The user's query and the extracted log data are formatted into a prompt and sent to the configured LLM (Gemini by default) via LiteLLM.
5.  **Response**: The LLM's analysis is printed to the console.

## Future Enhancements

-   More sophisticated Natural Language Understanding (NLU) for query interpretation.
-   Support for analyzing compressed log archives (`.tar.gz`) directly.
-   Interactive mode for follow-up questions.
-   More granular context management and summarization for very large log files.
-   Broader mapping of Kubernetes resources and query types.
